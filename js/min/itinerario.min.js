function Itinerario(e,i,n){function t(){s.append("<div class=timeline0><div class=line><ol class=linei id=recorrido></ol> </div> <div class=datos>hora0 de salida</div></div>"),timeline0=$(".timeline0"),datos=timeline0.children(".datos"),line=timeline0.children(".line"),lineG=line.children(".linei"),estaciones=[],lineasContol=[],l=[];for(var i=0;o>i;i++)estaciones.push("<li class=estacion1></li>");lineG.append(estaciones.join(""));for(var i=0;o>i;i++)lineasContol.push("<div class='lineT' style=left:"+e*i+"px><span class=tooltiptext>Hola</span></div>");lineG.append(lineasContol.join(""));for(var n=lineG.children(".estacion1"),i=0;o>i;i++)setPosTimelineE(i,e,n.eq(i));return l.push($(".timeline")),l.push(a(e,l[0],o)),l.push($("#recorrido").html()),timeline0.remove(),l}function r(n){for(var t=[],r=0;n>r;r++)t.push("<div class=estacion>"+i[r].nombre+"</div>");$("body").append("<div class=cajaP><div class=timeline><div class=line><ol style=background-color:transparent class=linei>"+t.join("")+"</ol></div><ul class=mover><li><a href=#0 class=prev class=inactive>Anterior</a></li><li><a href=#0 class=next>Siguiente</a></li></ul></div><div class=caja></div></div>"),$(".prev").addClass("inactive");for(var a=$(".estacion"),r=0;n>r;r++)setPosTimelineE(r,e,a.eq(r))}function a(e,i,n){return totalWidth=n*e+e,i.children(".line").children(".linei").css("width",totalWidth+"px"),totalWidth}var o=i.length;r(o,i);var s=$(".caja"),l=t(),c=[],d=l[0],u=l[1],m=l[2],p=20,v=10,f=[];$("select").material_select(),$(".indicador").eq(0).css("background-color","#"+n),d.find(".mover").on("click",".next",function(e){e.preventDefault(),updateSlide(d,u,"next"),timeline0=$(".timeline0");for(var i=0;i<timeline0.length;i++)updateSlide(timeline0.eq(i),u,"next")}),d.find(".mover").on("click",".prev",function(e){e.preventDefault(),updateSlide(d,u,"prev");for(var i=0;i<timeline0.length;i++)updateSlide(timeline0.eq(i),u,"prev")}),this.agregarRecorrido=function(e,i,n,t){c.push(new Bus(e,i,n,t,s,u,m)),f.push(e)},this.getRecorridos=function(){return s},this.removeRecorrido=function(e){index=f.indexOf(""+e),index>-1&&(f.splice(index,1),c.splice(index,1)),bus=s.find("#recorrido"+e),bus.remove(),s=$(".caja")},this.getBusesAceptados=function(){return f},this.getVectorIndices=function(e){indices=[];for(var i=0;i<f.length;i++)indice=e.indexOf(f[i]),indice>-1&&indices.push(indice);return indices},this.actualizarBus=function(i,n){var t=$.grep(c,function(e){return e.idRecorrido==n.idRecorrido})[0];elemento=i.find(".bus"),linea=i.find(".lineT"),dis=Math.round(n.porcAvan),elemento.css("left",dis+"px"),elemento.css("transform","translateX(-50%)"),elemento.css("transition","left 1s linear"),t.getModAnteEsta()>n.porcAvan%100&&n.porcAvan%100!=0&&(TEstaciones=(n.hora-t.getHoraIni())/1e3,t.getEstadoAvance()?(difTiempoSegu=TEstaciones-n.tiemEstaDete,difTiempoSegu>v?($(linea.eq(n.porcAvan.toString()[0]-1)).children(".tooltiptext").text("+"+difTiempoSegu+" [s]"),linea.eq(n.porcAvan.toString()[0]-1).css("background-color","#FF5252"),linea.eq(n.porcAvan.toString()[0]-1).css("width",e+"px")):-1*v>difTiempoSegu?($(linea.eq(n.porcAvan.toString()[0]-1)).children(".tooltiptext").text("-"+difTiempoSegu+" [s]"),linea.eq(n.porcAvan.toString()[0]-1).css("background-color","#3F51B5"),linea.eq(n.porcAvan.toString()[0]-1).css("width",e+"px")):($(linea.eq(n.porcAvan.toString()[0]-1)).children(".tooltiptext").text("A tiempo"),linea.eq(n.porcAvan.toString()[0]-1).css("background-color","#1BCE7C"),linea.eq(n.porcAvan.toString()[0]-1).css("width",e+"px")),t.setHoraIni(n.hora)):(t.setHoraIni(n.hora),t.setEstadoAvance(!0))),n.porcAvan%100!=0&&t.setModAnteEsta(n.porcAvan%100),TRecorrido=(n.hora-n.horaSaliDete)/1e3,TRecorrido-n.tiemAcumDete>p?elemento.css("background-image","url(../img/bus-markern.svg)"):TRecorrido-n.tiemAcumDete<-1*p?elemento.css("background-image","url(../img/bus-markeraz.svg)"):elemento.css("background-image","url(../img/bus-markerv.svg)")}}function setPosTimelineE(e,i,n){disNormal=Math.round(e*i+i),n.css("left",disNormal+"px"),n.css("transform","translateX(-50%)")}function updateSlide(e,i,n){var t=e.children(".line"),r=t.children(".linei"),a=getTranslateValue(r),o=Number(t.css("width").replace("px",""));"next"==n?translateTimeline(e,a-o,o-i):translateTimeline(e,a+o)}function getTranslateValue(e){var i=window.getComputedStyle(e.get(0),null),n=i.getPropertyValue("-webkit-transform")||i.getPropertyValue("-moz-transform")||i.getPropertyValue("-ms-transform")||i.getPropertyValue("-o-transform")||i.getPropertyValue("transform");if(n.indexOf("(")>=0){var n=n.split("(")[1];n=n.split(")")[0],n=n.split(",");var t=n[4]}else var t=0;return Number(t)}function translateTimeline(e,i,n){var t=e.children(".line").children(".linei").get(0),r=e.find(".mover");i=i>0?0:i,i="undefined"!=typeof n&&n>i?n:i,setTransformValue(t,"translateX",i+"px"),0==i?r.find(".prev").addClass("inactive"):r.find(".prev").removeClass("inactive"),i==n?r.find(".next").addClass("inactive"):r.find(".next").removeClass("inactive")}function setTransformValue(e,i,n){e.style["-webkit-transform"]=i+"("+n+")",e.style["-moz-transform"]=i+"("+n+")",e.style["-ms-transform"]=i+"("+n+")",e.style["-o-transform"]=i+"("+n+")",e.style.transform=i+"("+n+")"}